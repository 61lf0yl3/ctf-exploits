package main

import (
	"fmt"
	"io/ioutil"
	"net/http"
	"strconv"
	"strings"
)

func main() {
	var url = "http://challenge01.root-me.org/programmation/ch1/index.php"
	req, _ := http.NewRequest("GET", url, nil)
	res, _ := http.DefaultClient.Do(req)
	defer res.Body.Close()
	var mycookie string
	for _, cookie := range res.Cookies() {
		mycookie = cookie.Value
	}
	body, _ := ioutil.ReadAll(res.Body)
	resp := string(body)
	fmt.Print(resp)
	s := strings.Split(resp, " ")
	num1, _ := strconv.Atoi(s[12])
	sing := s[16]
	num2, _ := strconv.Atoi(s[20])
	num3, _ := strconv.Atoi(TrimNum(s[24]))
	num4, _ := strconv.Atoi(TrimNum(s[28]))
	var sumnum4 int
	fmt.Println()
	fmt.Println("this is num1", num1)
	fmt.Println("this is sing", sing)
	fmt.Println("this is num2", num2)
	fmt.Println("this is num3", num3)
	fmt.Println("this is num4", num4)
	for i := 0; i < num4; i++ {
		sumnum4 += i
	}
	var result int
	if sing == "-" {
		result = num3 + num1*num4 + (num2*sumnum4)*(-1)
	} else {
		result = num3 + num1*num4 + (num2 * sumnum4)
	}

	fmt.Println(result)
	url = "http://challenge01.root-me.org/programmation/ch1/ep1_v.php?result=" + strconv.Itoa(result)
	fmt.Println(url)
	req, _ = http.NewRequest("GET", url, nil)
	req.Header.Set("Cookie", "PHPSESSID="+mycookie+";")
	res, _ = http.DefaultClient.Do(req)
	defer res.Body.Close()
	body, _ = ioutil.ReadAll(res.Body)
	resp = string(body)
	fmt.Print(resp)
}

func TrimNum(str string) string {
	var res string
	for _, l := range str {
		if l >= '0' && l <= '9' {
			res += string(l)
		}
	}
	return res
}
